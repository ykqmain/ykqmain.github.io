<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Awake – 保持屏幕常亮</title>

    <!-- Favicon -->
    <link rel="icon" href="https://ykqmain.net/favicon.ico" type="image/x-icon">

    <!-- 页面主题色（移动端状态栏颜色） -->
    <meta name="theme-color" content="#34c759">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", sans-serif;
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: #f2f2f7;
            color: #1c1c1e;
        }

        h1 {
            font-size: 3rem;
            margin-bottom: 20px;
            font-weight: 600;
        }

        /* ===== 开关 ===== */
        .switch {
            position: relative;
            display: inline-block;
            width: 80px;
            height: 40px;
        }

        .switch input {
            display: none;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 999px;
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            box-shadow: inset 0 0 1px rgba(255, 255, 255, 0.3), 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: 0.4s;
            overflow: hidden;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 34px;
            width: 34px;
            left: 3px;
            bottom: 3px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2), inset 0 0 2px rgba(255, 255, 255, 0.5);
            transition: 0.4s;
            z-index: 2;
        }

        .slider::after {
            content: "";
            position: absolute;
            top: 0;
            left: -50%;
            width: 200%;
            height: 100%;
            background: linear-gradient(120deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.3) 50%, rgba(255, 255, 255, 0.1) 100%);
            transform: translateX(0);
            transition: transform 0.4s;
            border-radius: 999px;
            pointer-events: none;
            z-index: 1;
        }

        input:checked+.slider {
            background: rgba(52, 199, 89, 0.25);
            box-shadow: inset 0 0 2px rgba(255, 255, 255, 0.3), 0 6px 18px rgba(52, 199, 89, 0.3);
        }

        input:checked+.slider:before {
            transform: translateX(40px);
            background: rgba(52, 199, 89, 0.95);
        }

        input:checked+.slider::after {
            transform: translateX(100%);
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ===== 页面计时器 ===== */
        #timer {
            margin-top: 30px;
            font-size: 1.2rem;
            font-weight: 500;
        }
    </style>
</head>

<body>

    <h1>Awake</h1>

    <label class="switch">
        <input type="checkbox" id="toggleSwitch">
        <span class="slider"></span>
    </label>

    <div id="timer">运行时间：00:00:00</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/nosleep/0.12.0/NoSleep.min.js"></script>
    <script>
        // ===== Wake Lock & 页面计时器 =====
        let wakeLock = null, noSleep = null, startTime = null, timerInterval = null;
        const toggle = document.getElementById("toggleSwitch");
        const timerEl = document.getElementById("timer");

        function formatTime(ms) {
            const t = Math.floor(ms / 1000);
            return `${String(Math.floor(t / 3600)).padStart(2, '0')}:${String(Math.floor((t % 3600) / 60)).padStart(2, '0')}:${String(t % 60).padStart(2, '0')}`;
        }

        function startTimer() {
            startTime = Date.now();
            timerInterval = setInterval(() => {
                timerEl.textContent = `运行时间：${formatTime(Date.now() - startTime)}`;
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
            timerInterval = null;
        }

        async function enableAwake() {
            if ('wakeLock' in navigator) {
                try {
                    wakeLock = await navigator.wakeLock.request("screen");
                    wakeLock.addEventListener("release", () => {
                        disableAwake();
                        toggle.checked = false;
                    });
                } catch (e) { fallbackNoSleep(); }
            } else { fallbackNoSleep(); }
            startTimer();
        }

        function fallbackNoSleep() {
            if (!noSleep) { noSleep = new NoSleep(); noSleep.enable(); }
        }

        function disableAwake() {
            if (wakeLock) { wakeLock.release(); wakeLock = null; }
            if (noSleep) { noSleep.disable(); noSleep = null; }
            stopTimer();
        }

        toggle.addEventListener("change", () => { toggle.checked ? enableAwake() : disableAwake(); });
        document.addEventListener("visibilitychange", () => { if ((wakeLock || noSleep) && document.visibilityState === 'visible') enableAwake(); });
    </script>

</body>

</html>