<!DOCTYPE html>


  <html class="light page-post">


<head>
  <meta charset="utf-8">
  
  <title>Hadoop完全分布式搭建 | iAnna</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="Linux,大数据,Hadoop,CentOS,Java," />
  

  <meta name="description" content="准备工作环境： 123456789本机：macOS 虚拟机(VirtualBox)：CentOS 6.9复制三个CentOS一个作为主节点(Master)，两个从节点(Slave)三台虚拟机器名分别为：master, slave1, slave2 Hadoop 2.7.3JDK 1.8  Vim常用操作： 12345678910111213esc    从编辑模式切换到命令模式a      切换到">
<meta property="og:type" content="article">
<meta property="og:title" content="Hadoop完全分布式搭建">
<meta property="og:url" content="https://blog.ykqmain.com/hadoop/index.html">
<meta property="og:site_name" content="iAnna">
<meta property="og:description" content="准备工作环境： 123456789本机：macOS 虚拟机(VirtualBox)：CentOS 6.9复制三个CentOS一个作为主节点(Master)，两个从节点(Slave)三台虚拟机器名分别为：master, slave1, slave2 Hadoop 2.7.3JDK 1.8  Vim常用操作： 12345678910111213esc    从编辑模式切换到命令模式a      切换到">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://ianna.oss-cn-hangzhou.aliyuncs.com/cloud-drive/wordcount.png">
<meta property="article:published_time" content="2017-06-26T16:00:00.000Z">
<meta property="article:modified_time" content="2022-01-19T15:45:12.436Z">
<meta property="article:author" content="秋风木叶">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="大数据">
<meta property="article:tag" content="Hadoop">
<meta property="article:tag" content="CentOS">
<meta property="article:tag" content="Java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ianna.oss-cn-hangzhou.aliyuncs.com/cloud-drive/wordcount.png">

  

  
    <link rel="icon" href="/favicon.ico">
  

  <link href="/css/styles.css?v=c114cbeddx" rel="stylesheet">


  
    
<link rel="stylesheet" href="/css/personal-style.css">

  

  

  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?8b353d5983c1b9b0e49c36001b251d6f";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  
  <script type="text/javascript">
	(function(){
	    var bp = document.createElement('script');
	    var curProtocol = window.location.protocol.split(':')[0];
	    if (curProtocol === 'https') {
	        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
	    }
	    else {
	        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
	    }
	    var s = document.getElementsByTagName("script")[0];
	    s.parentNode.insertBefore(bp, s);
	})();
  </script>



  
    <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
  

<meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="/atom.xml" title="iAnna" type="application/atom+xml">
</head>

<body>


  
    <span id="toolbox-mobile" class="toolbox-mobile">地图</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">地图</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="ROUND_RECT"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            博客
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="ROUND_RECT"
            href="/category/"
            rel="noopener noreferrer"
            target="_self"
            >
            分类
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="ROUND_RECT"
            href="/tag/"
            rel="noopener noreferrer"
            target="_self"
            >
            标签
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="ROUND_RECT"
            href="/link/"
            rel="noopener noreferrer"
            target="_self"
            >
            友链
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="ROUND_RECT"
            href="/about/"
            rel="noopener noreferrer"
            target="_self"
            >
            关于
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="ROUND_RECT"
            href="/search/"
            rel="noopener noreferrer"
            target="_self"
            >
            搜索
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="ROUND_RECT"
            href="/atom.xml"
            rel="noopener noreferrer"
            target="_blank"
            >
            RSS
          </a>
        </li>
      
    </ul>
  </div>


</div>




<div class="content content-post CENTER">
   <article id="post-Hadoop完全分布式搭建" class="article article-type-post" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">Hadoop完全分布式搭建</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2017.06.27</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>秋风木叶</span>
        </span>
      

      
  <span class="article-category">
    <i class="icon-list"></i>
    <a class="article-category-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/">计算机</a>
  </span>



      

      
      <i class="fa fa-eye"></i> 
        <span id="busuanzi_container_page_pv">
           &nbsp热度 <span id="busuanzi_value_page_pv">
           <i class="fa fa-spinner fa-spin"></i></span>℃
        </span>
      
      
    </div>
  </header>

  <div class="article-content">
    
      <h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>环境：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">本机：macOS</span><br><span class="line"> </span><br><span class="line">虚拟机(VirtualBox)：CentOS 6.9</span><br><span class="line">复制三个CentOS</span><br><span class="line">一个作为主节点(Master)，两个从节点(Slave)</span><br><span class="line">三台虚拟机器名分别为：master, slave1, slave2</span><br><span class="line"> </span><br><span class="line">Hadoop 2.7.3</span><br><span class="line">JDK 1.8</span><br></pre></td></tr></table></figure>

<p>Vim常用操作：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">esc    从编辑模式切换到命令模式</span><br><span class="line">a      切换到编辑模式，在光标后插入</span><br><span class="line">o      切换到编辑模式，在光标下一行插入</span><br><span class="line"> </span><br><span class="line">命令模式下：</span><br><span class="line">u      撤销操作</span><br><span class="line">G      跳至文件末尾</span><br><span class="line">dd     删除光标那一行字符</span><br><span class="line">ggdG   清空内容</span><br><span class="line"> </span><br><span class="line">:wq    保存退出</span><br><span class="line">:q     退出</span><br><span class="line">:q!    强制退出</span><br></pre></td></tr></table></figure>

<br>


<h2 id="配置虚拟机"><a href="#配置虚拟机" class="headerlink" title="配置虚拟机"></a>配置虚拟机</h2><ol>
<li><p>安装虚拟机</p>
<ol>
<li><p>下载并安装<a target="_blank" rel="noopener" href="https://www.centos.org/">CentOS</a>，我选择的 CentOS 6.9</p>
</li>
<li><p>配置Java</p>
<ol>
<li>卸载自带的jdk<ul>
<li><code>rpm -qa | grep jdk</code>查看目前系统的jdk</li>
<li>使用<code>yum -y remove 名称</code> 一个个卸载<br></li>
</ul>
</li>
<li>安装 <a target="_blank" rel="noopener" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">jdk</a><br></li>
<li>配置JAVA环境变量<ul>
<li><code>cd</code>到<code>/usr/</code>目录下创建java文件夹，<code>mkdir java</code></li>
<li><code>tar -zxvf 文件名</code>解压到<code>/usr/java/</code>目录下</li>
<li>将jdk的包名改为”jdk”，<code>mv 包名 jdk</code></li>
<li><code>vim ／etc/profile</code>配置环境变量，在文件末尾添加：<br>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/java/jdk</span><br><span class="line"><span class="built_in">export</span> JRE_HOME=/usr/java/jdk/jre</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$CLASSPATH</span>:<span class="variable">$JAVA_HOME</span>/lib:<span class="variable">$JRE_HOME</span>/lib</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$JRE_HOME</span>/bin</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>检测<ul>
<li>环境变量生效 <code>source /etc/profile</code></li>
<li>检测 <code>java -version</code></li>
</ul>
</li>
</ol>
</li>
<li><p>将一台CentOS虚拟机克隆成3台</p>
<p> VirtualBox有这个功能，复制2个虚拟机，Mac地址重新分配。</p>
<ol>
<li><p>修改机器名 <code>vim /etc/sysconfig/network</code></p>
</li>
<li><p><strong>全程使用root账户</strong> </p>
</li>
<li><p>关闭防火墙，GUI设置，或者<code>service iptables stop</code></p>
</li>
<li><p>检验各个主机之间能否连通，<code>ping ip</code></p>
</li>
<li><p>不管用什么办法，让IP固定不变。设置静态IP，或者使用路由器固定IP。</p>
<p> 我的配置如下：</p>
<table>
<thead>
<tr>
<th>机器名</th>
<th>IP</th>
</tr>
</thead>
<tbody><tr>
<td>master</td>
<td>192.168.76.11</td>
</tr>
<tr>
<td>slave1</td>
<td>192.168.76.12</td>
</tr>
<tr>
<td>slave2</td>
<td>192.168.76.13</td>
</tr>
</tbody></table>
</li>
</ol>
</li>
</ol>
</li>
<li><p>设置hosts</p>
<p> 三台机器全部设置</p>
<p> <code>vim /etc/hosts</code></p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1       localhost.localdomain localhost</span><br><span class="line">::1             localhost6.localdomain6 localhost6</span><br><span class="line">#增加了下面3行</span><br><span class="line">192.168.76.11   master</span><br><span class="line">192.168.76.12   slave1</span><br><span class="line">192.168.76.13  slave2</span><br></pre></td></tr></table></figure></li>
</ol>
<br>


<h2 id="配置ssh免密码登陆"><a href="#配置ssh免密码登陆" class="headerlink" title="配置ssh免密码登陆"></a>配置ssh免密码登陆</h2><ol>
<li><p>ssh配置，<code>vim /etc/ssh/sshd_config</code></p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 以下三项修改成以下配置</span><br><span class="line">RSAAuthentication yes # 启用 RSA 认证</span><br><span class="line">PubkeyAuthentication yes # 启用公钥私钥配对认证方式</span><br><span class="line">AuthorizedKeysFile .ssh/authorized_keys # 公钥文件路径（和上面生成的文件同）</span><br></pre></td></tr></table></figure></li>
<li><p>生成ssh key</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd ~</span><br><span class="line">ssh-keygen</span><br><span class="line">一路回车，这样就在~/.ssh目录下生成了几个文件</span><br><span class="line">cd ~/.ssh</span><br><span class="line">cat id_rsa.pub &gt;&gt; authorized_keys  #这个命令将id_rsa.pub的内容追加了authorized_keys的内容后面</span><br></pre></td></tr></table></figure>
<p> 重启ssh服务，<code>service sshd restart</code></p>
</li>
<li><p>免密登陆</p>
<ol>
<li>去另外两台机器用同样的方式生成<code>id_rsa.pub</code></li>
<li>分别把它们复制到master机器上</li>
<li>在slave1机器上，<code>scp id_rsa.pub root@192.168.76.11:~/.ssh/id_rsa.pub.1</code></li>
<li>在slave1机器上，<code>scp id_rsa.pub root@192.168.76.11:~/.ssh/id_rsa.pub.2</code></li>
<li>回到master机器的<code>~/.ssh</code>目录，执行<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat id_rsa.pub.1 &gt;&gt; authorized_keys</span><br><span class="line">cat id_rsa.pub.2 &gt;&gt; authorized_keys</span><br></pre></td></tr></table></figure></li>
<li>最后我们把这个<code>authorized_keys</code>用scp命令复制到两个从节点上，这样三台机器两两之间就能互相访问了<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp authorized_keys root@192.168.76.12:~/.ssh/</span><br><span class="line">scp authorized_keys root@192.168.76.13:~/.ssh/</span><br></pre></td></tr></table></figure></li>
<li>给<code>.ssh</code>目录和<code>.ssh/authorized_keys</code>设置权限，<strong>三台机器都执行</strong>：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod 700 ~/.ssh</span><br><span class="line">chmod 644 ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>在各主机下进行无密码登陆测试</p>
</li>
</ol>
<br>


<h2 id="配置hadoop"><a href="#配置hadoop" class="headerlink" title="配置hadoop"></a>配置hadoop</h2><p>下载<a target="_blank" rel="noopener" href="http://hadoop.apache.org/releases.html">hadoop</a>，选择binary包，我下载的hadoop2.7.3，传到master的<code>/usr/</code>下，解压，并将文件夹名改名为<code>hadoop</code>。</p>
<p>涉及到的配置文件有7个：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">~/usr/hadoop/etc/hadoop/hadoop-env.sh </span><br><span class="line">~/usr/hadoop/etc/hadoop/yarn-env.sh </span><br><span class="line">~/usr/hadoop/etc/hadoop/core-site.xml </span><br><span class="line">~/usr/hadoop/etc/hadoop/hdfs-site.xml </span><br><span class="line">~/usr/hadoop/etc/hadoop/mapred-site.xml </span><br><span class="line">~/usr/hadoop/etc/hadoop/yarn-site.xml</span><br><span class="line">~/usr/hadoop/etc/hadoop/slaves </span><br></pre></td></tr></table></figure>

<br>

<p>1.<code>vim ~/usr/hadoop/etc/hadoop/hadoop-env.sh </code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 这个文件要修改的地方就是JAVA_HOME环境变量</span><br><span class="line"># The java implementation to use.</span><br><span class="line">export JAVA_HOME=/usr/java/jdk</span><br></pre></td></tr></table></figure>

<p>2.<code>vim ~/usr/hadoop/etc/hadoop/yarn-env.sh </code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># yarn的环境配置，同样只需要修改JAVA_HOME就行，找到下面这行</span><br><span class="line"># some Java parameters</span><br><span class="line">export JAVA_HOME=/usr/java/jdk</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><code>mkdir ~/usr/hadoop/tmp</code><br> <code>vim ~/usr/hadoop/etc/hadoop/core-site.xml </code></li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/hadoop/hadoop/tmp<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.default.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://master:9000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>4.<code>vim ~/usr/hadoop/etc/hadoop/hdfs-site.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#hdfs的配置文件，dfs.http.address配置了hdfs的http的访问位置；dfs.replication配置了文件块的副本数，一般不大于从机的个数。</span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.http.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>master:50070<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.secondary.http-address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>master:50090<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>5.修改模板文件，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/usr/hadoop/etc/hadoop/</span><br><span class="line">cp mapred-site.xml.template mapred-site.xml</span><br></pre></td></tr></table></figure>

<p><code>vim ~/usr/hadoop/etc/hadoop/mapred-site.xml </code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Put site-specific property overrides in this file. --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>mapred.job.tracker<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>master:9001<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>mapred.map.tasks<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>20<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>mapred.reduce.tasks<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>4<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>master:10020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.webapp.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>master:19888<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>6.<code>vim ~/usr/hadoop/etc/hadoop/yarn-site.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">#该文件为yarn框架的配置,主要是一些任务的启动位置</span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Site specific YARN configuration properties --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>master:8032<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.scheduler.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">value</span>&gt;</span>master:8030<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.webapp.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">value</span>&gt;</span>master:8088<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.resource-tracker.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>master:8031<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.admin.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>master:8033<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services.mapreduce.shuffle.class<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.hadoop.mapred.ShuffleHandler<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>7.<code>vim ~/usr/hadoop/etc/hadoop/slaves</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 这是设置从节点hostname的地方，一行一个</span><br><span class="line">slave1</span><br><span class="line">slave2</span><br></pre></td></tr></table></figure>

<p><strong>配置完成</strong></p>
<br>

<p>8.将配置好的hadoop复制到其他机器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp -r /usr/hadoop root@192.168.76.12:/usr/</span><br><span class="line">scp –r /usr/hadoop root@192.168.76.13:/usr/</span><br></pre></td></tr></table></figure>

<p><strong>安装完成</strong></p>
<br>


<h2 id="验证并测试hadoop"><a href="#验证并测试hadoop" class="headerlink" title="验证并测试hadoop"></a>验证并测试hadoop</h2><ol>
<li><p>启动</p>
<p> hadoop的安装目录为 <code>/usr/hadoop</code></p>
<p> 可选配置hadoop环境变量，<code>vim ／etc/profile</code></p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> HADOOP_INSTALL=/usr/hadoop  </span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$&#123;HADOOP_INSTALL&#125;</span>/bin:<span class="variable">$&#123;HADOOP_INSTALL&#125;</span>/sbin<span class="variable">$&#123;PATH&#125;</span>  </span><br><span class="line"><span class="built_in">export</span> HADOOP_MAPRED_HOME=<span class="variable">$&#123;HADOOP_INSTALL&#125;</span>  </span><br><span class="line"><span class="built_in">export</span> HADOOP_COMMON_HOME=<span class="variable">$&#123;HADOOP_INSTALL&#125;</span>  </span><br><span class="line"><span class="built_in">export</span> HADOOP_HDFS_HOME=<span class="variable">$&#123;HADOOP_INSTALL&#125;</span>  </span><br><span class="line"><span class="built_in">export</span> YARN_HOME=<span class="variable">$&#123;HADOOP_INSTALLL&#125;</span>  </span><br><span class="line"><span class="built_in">export</span> HADOOP_COMMON_LIB_NATIVE_DIR=<span class="variable">$&#123;HADOOP_INSTALL&#125;</span>/lib/natvie    </span><br><span class="line"><span class="built_in">export</span> HADOOP_OPTS=<span class="string">&quot;-Djava.library.path=<span class="variable">$&#123;HADOOP_INSTALL&#125;</span>/lib:<span class="variable">$&#123;HADOOP_INSTALL&#125;</span>/lib/native&quot;</span> </span><br></pre></td></tr></table></figure>
<p> <code>source /etc/profile</code></p>
<ul>
<li>格式化Namenode  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/hadoop</span><br><span class="line">./bin/hdfs namenode -format</span><br></pre></td></tr></table></figure></li>
<li>启动  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/hadoop/sbin</span><br><span class="line">./start-dfs.sh</span><br><span class="line">./start-yarn.sh</span><br></pre></td></tr></table></figure></li>
</ul>
<p> 在三台机器上分别执行 jps 命令</p>
<ul>
<li><p>master上执行有四个进程</p>
<ul>
<li>NameNode</li>
<li>ResourceManager</li>
<li>&lt;&gt;</li>
<li>Jps</li>
</ul>
</li>
<li><p>slave上执行有三个进程</p>
<ul>
<li>DataNode </li>
<li>NodeManager </li>
<li>Jps </li>
</ul>
</li>
<li><p>输入以下指令查看报告，<code>hadoop dfsadmin -report</code></p>
</li>
</ul>
<p> 打开浏览器访问 <code>192.168.76.11:50070</code></p>
<p> <strong>检查 <code>Live Nodes</code> 是否为2</strong></p>
</li>
</ol>
<br>

<ol start="2">
<li><p>运行测试</p>
<p> 向hadoop集群系统提交第一个mapreduce任务(wordcount)，进入本地hadoop目录，<code>/usr/hadoop</code></p>
<ol>
<li><p>在虚拟分布式文件系统上创建一个测试目录/data/input<br><code>bin/hdfs dfs -mkdir -p /data/input</code></p>
</li>
<li><p>将当前目录下的README.txt 文件复制到虚拟分布式文件系统中<br><code>hdfs dfs -put README.txt /data/input</code></p>
</li>
<li><p>查看文件系统中是否存在我们所复制的文件<br><code>bin/hdfs dfs -ls /data/input</code></p>
</li>
<li><p>运行如下命令向hadoop提交单词统计任务<br><code>hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-2.7.3.jar wordcount /data/input /data/output/result</code></p>
</li>
<li><p>查看result，结果在result下面的part-r-00000中<br><code>hdfs dfs -cat /data/output/result/part-r-00000</code></p>
</li>
</ol>
<p> <img src="https://ianna.oss-cn-hangzhou.aliyuncs.com/cloud-drive/wordcount.png"></p>
<p> 成功运行，则搭建完成。</p>
<p> 停止运行，<code>sh /usr/hadoop/sbin/stop-all.sh</code></p>
</li>
</ol>
<p><br><br></p>
<p><strong>踩过的坑：</strong></p>
<ol>
<li><p>ssh免密登陆</p>
</li>
<li><p>重启Linux后Hadoop集群所有的DataNode都无法启动</p>
<ol>
<li><p>首先会出现几种情况，才会出现启动不了datanode的情况</p>
<ul>
<li>首先修改过master那台的配置文件</li>
<li>多次Hadoop namenode -format这种不好的习惯</li>
</ul>
</li>
<li><p>jps命令发现没有datanode启动</p>
<ul>
<li>到每个Slave机器下面去，找到<code>/usr/hadoop/tmp/dfs/</code>，会显示有data，把data文件夹删掉。</li>
<li>重启hadoop。</li>
</ul>
</li>
</ol>
</li>
</ol>
<p><br><br></p>

    
  </div>

</article>


   

   
  <div class="box-prev-next clearfix">
    <a class="show pull-left" href="/young/">
        <i class="icon icon-angle-left"></i>
    </a>
    <a class="show pull-right" href="/cloud-drive/">
        <i class="icon icon-angle-right"></i>
    </a>
  </div>




</div>


  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">关闭</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="ROUND_RECT"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              博客
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="ROUND_RECT"
              href="/category/"
              rel="noopener noreferrer"
              target="_self"
              >
              分类
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="ROUND_RECT"
              href="/tag/"
              rel="noopener noreferrer"
              target="_self"
              >
              标签
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="ROUND_RECT"
              href="/link/"
              rel="noopener noreferrer"
              target="_self"
              >
              友链
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="ROUND_RECT"
              href="/about/"
              rel="noopener noreferrer"
              target="_self"
              >
              关于
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="ROUND_RECT"
              href="/search/"
              rel="noopener noreferrer"
              target="_self"
              >
              搜索
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="ROUND_RECT"
              href="/atom.xml"
              rel="noopener noreferrer"
              target="_blank"
              >
              RSS
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    

    

    
    

    

    
    

    

  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
